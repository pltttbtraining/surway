<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ยิ้มรับดอกเบี้ยสูง - คำนวณผลประโยชน์</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }

        :root {
            --primary: #0066cc;
            --primary-dark: #004a99;
            --secondary: #00b386;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #adb5bd;
            --danger: #dc3545;
            --success: #28a745;
            --info: #17a2b8;
            --warning: #ffc107;
            --card-bg: #ffffff;
            --card-border: #e0e0e0;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding-bottom: 2rem;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .card-body {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--card-border);
            border-radius: 12px;
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.25);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: var(--primary-dark);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #00996d;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab {
            padding: 1rem 1.5rem;
            margin-right: 1rem;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid var(--card-border);
            border-bottom: none;
            background: #f0f2f5;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        th, td {
            padding: 1.2rem;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        th {
            background-color: #f0f2f5;
            font-weight: 600;
            color: var(--primary-dark);
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .dashboard-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--card-border);
        }

        .dashboard-card h3 {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .dashboard-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .dashboard-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .passcode-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            text-align: center;
        }

        .modal-content h2 {
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .passcode-input {
            width: 100%;
            padding: 1rem;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid var(--card-border);
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .hidden {
            display: none;
        }

        .highlight {
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .info-box h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .badge-primary {
            background: #e3f2fd;
            color: var(--primary);
        }

        .badge-success {
            background: #e8f5e9;
            color: var(--success);
        }

        .badge-warning {
            background: #fff8e1;
            color: var(--warning);
        }

        .badge-danger {
            background: #ffebee;
            color: var(--danger);
        }

        .footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 2rem;
            border-top: 1px solid var(--card-border);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .dashboard-value {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>โปรสุดปัง! ยิ้มรับดอกเบี้ยสูง</h1>
        <p>คำนวณผลประโยชน์จากประกันชีวิตพร้อมสิทธิ์ฝากเงินประจำดอกเบี้ยพิเศษ</p>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                ข้อมูลแบบประกัน
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="insurance-type">เลือกแบบประกัน</label>
                        <select id="insurance-type" class="form-control" required>
                            <option value="">เลือกแบบประกัน</option>
                            <option value="ttb-global-index-15-5-plus">ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 + พลัส</option>
                            <option value="ttb-global-index-15-5-max">ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 แม็กซ์</option>
                            <option value="ttb-legacy-99-5">ทีทีบี ส่งต่อความมั่งคั่ง 99/5</option>
                            <option value="ttb-happy-life-99-10">ทีทีบี แฮปปี้ ไลฟ์ โพรเทค 99/10</option>
                            <option value="ttb-ultimate-legacy-99-3">ทีทีบี อัลติเมท เลกาซี 99/3</option>
                            <option value="ttb-treasure-plan-2">ทีทีบี เดอะ เทรเชอร์ แผน 2</option>
                            <option value="ttb-money-saver-14-6">ทีทีบี มันนี่ เซฟเวอร์ 14/6</option>
                            <option value="ttb-smart-bonus-10-5">ทีทีบี สมาร์ท โบนัส 10/5</option>
                            <option value="ttb-money-saver-15-6">ทีทีบี มันนี่ เซฟเวอร์ 15/6</option>
                            <option value="ttb-premium-saver-11-3">ทีทีบี พรีเมียม เซฟเวอร์ 11/3</option>
                        </select>
                        <div class="error-message" id="insurance-error">กรุณาเลือกแบบประกัน</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="age">อายุ (ปี)</label>
                        <input type="number" id="age" class="form-control" min="0" max="100" placeholder="กรอกอายุ" required>
                        <div class="error-message" id="age-error">อายุไม่ตรงกับเกณฑ์แบบประกัน</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="coverage">ทุนประกัน (บาท)</label>
                        <input type="number" id="coverage" class="form-control" min="0" placeholder="กรอกทุนประกัน" required>
                        <div class="error-message" id="coverage-error">ทุนประกันไม่ตรงกับเกณฑ์แบบประกัน</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="premium">เบี้ยประกัน (บาท)</label>
                        <input type="number" id="premium" class="form-control" min="50000" placeholder="ขั้นต่ำ 50,000 บาท" required>
                        <div class="error-message" id="premium-error">เบี้ยประกันต้องไม่ต่ำกว่า 50,000 บาท</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                เลือกโปรโมชั่น
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="promotion-type">ประเภทโปรโมชั่น</label>
                        <select id="promotion-type" class="form-control" required>
                            <option value="">เลือกประเภทโปรโมชั่น</option>
                            <option value="td36">ฝากประจำ 36 เดือน (1.50%)</option>
                            <option value="td6">ฝากประจำ 6 เดือน (1.25%)</option>
                        </select>
                        <div class="error-message" id="promotion-error">กรุณาเลือกประเภทโปรโมชั่น</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="multiplier">จำนวนเท่าของเงินที่ฝาก (สูงสุด: <span id="max-multiplier">--</span>)</label>
                        <input type="number" id="multiplier" class="form-control" min="1" placeholder="กรอกจำนวนเท่า" required>
                        <div class="error-message" id="multiplier-error">จำนวนเท่าเกินสิทธิ์ที่กำหนด</div>
                    </div>
                </div>
                
                <div class="info-box">
                    <h3>ข้อมูลสิทธิ์การฝาก</h3>
                    <p><strong>แบบประกันกลุ่ม Wealth / คุ้มครองระยะยาว:</strong> ฝากได้สูงสุด 20 เท่า (36 เดือน) หรือ 15 เท่า (6 เดือน)</p>
                    <p><strong>แบบประกันกลุ่มออมทรัพย์ / ระยะกลาง:</strong> ฝากได้สูงสุด 10 เท่า (36 เดือน) หรือ 7.5 เท่า (6 เดือน)</p>
                </div>
                
                <button id="calculate-btn" class="btn btn-block">คำนวณผลประโยชน์</button>
            </div>
        </div>

        <div id="results-section" class="hidden">
            <div class="tabs">
                <div class="tab active" data-tab="tab1">สรุปผลตอบแทน</div>
                <div class="tab" data-tab="tab2">ผลประโยชน์ประกันฯ</div>
                <div class="tab" data-tab="tab3">ผลประโยชน์เงินฝาก</div>
                <div class="tab" data-tab="tab4" id="tab4">วิธีคำนวณ</div>
            </div>

            <!-- Tab 1: สรุปผลตอบแทน -->
            <div class="tab-content active" id="tab1">
                <div class="card">
                    <div class="card-header">
                        สรุปผลตอบแทน
                    </div>
                    <div class="card-body">
                        <div class="dashboard">
                            <div class="dashboard-card">
                                <h3>ผลประโยชน์ประกัน</h3>
                                <div class="dashboard-value" id="insurance-benefit">0 บาท</div>
                                <div class="dashboard-subtitle" id="insurance-irr">IRR: --</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>ผลประโยชน์เงินฝาก</h3>
                                <div class="dashboard-value" id="deposit-benefit">0 บาท</div>
                                <div class="dashboard-subtitle" id="deposit-irr">IRR: --</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>รวมผลประโยชน์</h3>
                                <div class="dashboard-value" id="total-benefit">0 บาท</div>
                                <div class="dashboard-subtitle">รวมทั้งประกันและเงินฝาก</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>ผลประโยชน์สุทธิ</h3>
                                <div class="dashboard-value" id="net-benefit">0 บาท</div>
                                <div class="dashboard-subtitle">หลังหักค่าเบี้ยและเงินต้น</div>
                            </div>
                        </div>
                        
                        <div class="highlight">
                            <h3>หมายเหตุ</h3>
                            <p>สำหรับแบบประกันตลอดชีพ (เช่น 99/10, 99/3, 99/5) จะแสดง "สร้างความคุ้มครองสุด xx% หรือ xx เท่า ของค่าเบี้ย" แทน IRR</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: ผลประโยชน์ประกันฯ -->
            <div class="tab-content" id="tab2">
                <div class="card">
                    <div class="card-header">
                        ผลประโยชน์ประกันชีวิต
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ปีกรมธรรม์</th>
                                        <th>เบี้ยประกัน</th>
                                        <th>เบี้ยประกันสะสม</th>
                                        <th>เงินระหว่างสัญญา</th>
                                        <th>เงินครบสัญญา</th>
                                    </tr>
                                </thead>
                                <tbody id="insurance-table-body">
                                    <!-- Data will be populated here -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>รวม</strong></td>
                                        <td id="total-premium">0 บาท</td>
                                        <td>-</td>
                                        <td id="total-midterm">0 บาท</td>
                                        <td id="total-maturity">0 บาท</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <div class="dashboard">
                            <div class="dashboard-card">
                                <h3>เบี้ยประกันที่ชำระ</h3>
                                <div class="dashboard-value" id="total-paid">0 บาท</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>เงินประโยชน์ตามสัญญา</h3>
                                <div class="dashboard-value" id="total-benefits">0 บาท</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>ผลประโยชน์สุทธิ</h3>
                                <div class="dashboard-value" id="net-insurance-benefit">0 บาท</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: ผลประโยชน์เงินฝาก -->
            <div class="tab-content" id="tab3">
                <div class="card">
                    <div class="card-header">
                        ผลประโยชน์เงินฝาก
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ปี</th>
                                        <th>จำนวนเงินที่ใช้ฝาก</th>
                                        <th>ดอกเบี้ยที่ได้รับ</th>
                                        <th>ดอกเบี้ยหลังหักภาษี</th>
                                    </tr>
                                </thead>
                                <tbody id="deposit-table-body">
                                    <!-- Data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="dashboard">
                            <div class="dashboard-card">
                                <h3>เงินต้น</h3>
                                <div class="dashboard-value" id="deposit-principal">0 บาท</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>ดอกเบี้ยก่อนหักภาษี</h3>
                                <div class="dashboard-value" id="deposit-interest">0 บาท</div>
                            </div>
                            <div class="dashboard-card">
                                <h3>ดอกเบี้ยหลังหักภาษี</h3>
                                <div class="dashboard-value" id="deposit-after-tax">0 บาท</div>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <h3>นโยบายการหักภาษี</h3>
                            <p>ดอกเบี้ยส่วนที่เกิน 20,000 บาท จะถูกหักภาษี 15%</p>
                            <p>ตัวอย่าง: หากดอกเบี้ยทั้งหมด 25,000 บาท จะถูกหักภาษี 750 บาท (5,000 x 15%)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: วิธีคำนวณ -->
            <div class="tab-content" id="tab4">
                <div class="card">
                    <div class="card-header">
                        วิธีคำนวณ
                    </div>
                    <div class="card-body">
                        <div class="info-box">
                            <h3>ขั้นตอนการคำนวณ IRR</h3>
                            <p>IRR (Internal Rate of Return) คืออัตราผลตอบแทนภายใน ซึ่งเป็นอัตราที่ทำให้มูลค่าปัจจุบันสุทธิ (NPV) เท่ากับศูนย์</p>
                        </div>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ปี</th>
                                        <th>เงินเข้า (บาท)</th>
                                        <th>เงินออก (บาท)</th>
                                        <th>กระแสเงินสด (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="calculation-table-body">
                                    <!-- Data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="highlight">
                            <h3>ขั้นตอนการคำนวณ</h3>
                            <ol>
                                <li>กำหนดกระแสเงินสด (Cash Flow) ทุกปี</li>
                                <li>ใช้สูตร IRR = ค้นหาอัตราที่ทำให้ NPV = 0</li>
                                <li>NPV = Σ [CFt / (1 + r)^t]</li>
                                <li>ใช้การคำนวณแบบ trial and error หรือใช้ฟังก์ชัน IRR ในโปรแกรมคำนวณ</li>
                            </ol>
                        </div>
                        
                        <button id="verify-calculation" class="btn btn-secondary">ตรวจสอบความถูกต้องการคำนวณ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="passcode-modal" id="passcode-modal">
        <div class="modal-content">
            <h2>ป้อน Passcode</h2>
            <p>กรุณาป้อน Passcode เพื่อเข้าใช้งานวิธีคำนวณ</p>
            <input type="password" id="passcode-input" class="passcode-input" maxlength="4">
            <button id="verify-passcode" class="btn">ยืนยัน</button>
        </div>
    </div>

    <div class="footer">
        <p>© 2025 บริษัท ทีทีบี ประกันชีวิต จำกัด (มหาชน) | โปรโมชั่น "ยิ้มรับดอกเบี้ยสูง" วันที่ 1 - 30 พฤศจิกายน 2568</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ข้อมูลแบบประกัน
            const insuranceProducts = {
                'ttb-global-index-15-5-plus': {
                    name: 'ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 + พลัส',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 50000,
                    maxCoverage: null,
                    group: 1,
                    term: 15,
                    payoutStructure: {
                        midTerm: {
                            interval: 2,
                            rate: 2.5
                        },
                        maturity: 500
                    }
                },
                'ttb-global-index-15-5-max': {
                    name: 'ทีทีบี โกลบอล อินเด็กซ์ พรินซิเพิล โพรเทค 15/5 แม็กซ์',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 50000,
                    maxCoverage: null,
                    group: 1,
                    term: 15,
                    payoutStructure: {
                        midTerm: {
                            interval: 2,
                            rate: 1
                        },
                        maturity: 500
                    }
                },
                'ttb-legacy-99-5': {
                    name: 'ทีทีบี ส่งต่อความมั่งคั่ง 99/5',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 50000,
                    maxCoverage: null,
                    group: 1,
                    term: 99,
                    payoutStructure: {
                        midTerm: null,
                        maturity: 100
                    }
                },
                'ttb-happy-life-99-10': {
                    name: 'ทีทีบี แฮปปี้ ไลฟ์ โพรเทค 99/10',
                    minAge: 0.08,
                    maxAge: 50,
                    minCoverage: 200000,
                    maxCoverage: null,
                    group: 1,
                    term: 99,
                    payoutStructure: {
                        midTerm: null,
                        maturity: 150
                    }
                },
                'ttb-ultimate-legacy-99-3': {
                    name: 'ทีทีบี อัลติเมท เลกาซี 99/3',
                    minAge: 0.08,
                    maxAge: 75,
                    minCoverage: 10000000,
                    maxCoverage: null,
                    group: 1,
                    term: 99,
                    payoutStructure: {
                        midTerm: null,
                        maturity: 100
                    }
                },
                'ttb-treasure-plan-2': {
                    name: 'ทีทีบี เดอะ เทรเชอร์ แผน 2',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 200000,
                    maxCoverage: null,
                    group: 1,
                    term: 88,
                    payoutStructure: {
                        midTerm: {
                            interval: 1,
                            rate: 8
                        },
                        maturity: 888
                    }
                },
                'ttb-money-saver-14-6': {
                    name: 'ทีทีบี มันนี่ เซฟเวอร์ 14/6',
                    minAge: 0.08,
                    maxAge: 80,
                    minCoverage: 50000,
                    maxCoverage: 300000,
                    group: 2,
                    term: 14,
                    payoutStructure: {
                        midTerm: {
                            years: [1,2,3,4,5,6,7,8,9,10,11,12,13],
                            rates: [2,2,2,2,2,2,4,4,4,4,4,4,4]
                        },
                        maturity: 654
                    }
                },
                'ttb-smart-bonus-10-5': {
                    name: 'ทีทีบี สมาร์ท โบนัส 10/5',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 0,
                    maxCoverage: null,
                    group: 2,
                    term: 10,
                    payoutStructure: {
                        midTerm: {
                            years: [2,4,6,8],
                            rates: [1,1,1,1]
                        },
                        maturity: 511
                    }
                },
                'ttb-money-saver-15-6': {
                    name: 'ทีทีบี มันนี่ เซฟเวอร์ 15/6',
                    minAge: 0.08,
                    maxAge: 70,
                    minCoverage: 100000,
                    maxCoverage: null,
                    group: 2,
                    term: 15,
                    payoutStructure: {
                        midTerm: {
                            interval: 1,
                            rate: 2.5
                        },
                        maturity: 150
                    }
                },
                'ttb-premium-saver-11-3': {
                    name: 'ทีทีบี พรีเมียม เซฟเวอร์ 11/3',
                    minAge: 0.08,
                    maxAge: 80,
                    minCoverage: 300000,
                    maxCoverage: null,
                    group: 2,
                    term: 11,
                    payoutStructure: {
                        midTerm: {
                            years: [2,4,6,8,10],
                            rates: [1,1,1,1,1]
                        },
                        maturity: 349.5
                    }
                }
            };

            // ตัวแปรสำหรับเก็บข้อมูล
            let selectedProduct = null;
            let calculationData = null;

            // ฟังก์ชันตรวจสอบความถูกต้องของข้อมูล
            function validateForm() {
                let isValid = true;
                
                // รีเซ็ตข้อความผิดพลาด
                document.querySelectorAll('.error-message').forEach(el => {
                    el.style.display = 'none';
                });
                
                // ตรวจสอบแบบประกัน
                const insuranceType = document.getElementById('insurance-type').value;
                if (!insuranceType) {
                    document.getElementById('insurance-error').style.display = 'block';
                    isValid = false;
                } else {
                    selectedProduct = insuranceProducts[insuranceType];
                }
                
                // ตรวจสอบอายุ
                const age = parseFloat(document.getElementById('age').value);
                if (isNaN(age) || age < selectedProduct.minAge || age > selectedProduct.maxAge) {
                    document.getElementById('age-error').style.display = 'block';
                    isValid = false;
                }
                
                // ตรวจสอบทุนประกัน
                const coverage = parseFloat(document.getElementById('coverage').value);
                if (isNaN(coverage) || coverage < selectedProduct.minCoverage || 
                   (selectedProduct.maxCoverage && coverage > selectedProduct.maxCoverage)) {
                    document.getElementById('coverage-error').style.display = 'block';
                    isValid = false;
                }
                
                // ตรวจสอบเบี้ยประกัน
                const premium = parseFloat(document.getElementById('premium').value);
                if (isNaN(premium) || premium < 50000) {
                    document.getElementById('premium-error').style.display = 'block';
                    isValid = false;
                }
                
                // ตรวจสอบประเภทโปรโมชั่น
                const promotionType = document.getElementById('promotion-type').value;
                if (!promotionType) {
                    document.getElementById('promotion-error').style.display = 'block';
                    isValid = false;
                }
                
                // ตรวจสอบจำนวนเท่า
                const multiplier = parseFloat(document.getElementById('multiplier').value);
                if (isNaN(multiplier) || multiplier < 1) {
                    document.getElementById('multiplier-error').style.display = 'block';
                    isValid = false;
                } else {
                    // ตรวจสอบว่าไม่เกินสิทธิ์
                    let maxMultiplier = 0;
                    if (selectedProduct.group === 1) {
                        maxMultiplier = promotionType === 'td36' ? 20 : 15;
                    } else {
                        maxMultiplier = promotionType === 'td36' ? 10 : 7.5;
                    }
                    
                    if (multiplier > maxMultiplier) {
                        document.getElementById('multiplier-error').style.display = 'block';
                        isValid = false;
                    }
                }
                
                return isValid;
            }

            // ฟังก์ชันคำนวณผลประโยชน์
            function calculateBenefits() {
                const insuranceType = document.getElementById('insurance-type').value;
                const age = parseFloat(document.getElementById('age').value);
                const coverage = parseFloat(document.getElementById('coverage').value);
                const premium = parseFloat(document.getElementById('premium').value);
                const promotionType = document.getElementById('promotion-type').value;
                const multiplier = parseFloat(document.getElementById('multiplier').value);
                
                selectedProduct = insuranceProducts[insuranceType];
                
                // คำนวณเงินฝาก
                const depositAmount = premium * multiplier;
                const depositRate = promotionType === 'td36' ? 0.015 : 0.0125;
                const depositTerm = promotionType === 'td36' ? 3 : 0.5;
                
                // คำนวณผลประโยชน์เงินฝาก
                const depositInterest = depositAmount * depositRate * depositTerm;
                const taxDeduction = Math.max(0, depositInterest - 20000) * 0.15;
                const depositAfterTax = depositInterest - taxDeduction;
                
                // คำนวณผลประโยชน์ประกัน
                let insuranceBenefit = 0;
                let maturityValue = 0;
                
                if (selectedProduct.payoutStructure.midTerm) {
                    // คำนวณผลประโยชน์ระหว่างสัญญา
                    if (selectedProduct.payoutStructure.midTerm.interval) {
                        const interval = selectedProduct.payoutStructure.midTerm.interval;
                        const rate = selectedProduct.payoutStructure.midTerm.rate;
                        const years = Math.floor(selectedProduct.term / interval);
                        
                        for (let i = 1; i <= years; i++) {
                            insuranceBenefit += coverage * (rate / 100);
                        }
                    } else {
                        selectedProduct.payoutStructure.midTerm.years.forEach((year, index) => {
                            insuranceBenefit += coverage * (selectedProduct.payoutStructure.midTerm.rates[index] / 100);
                        });
                    }
                }
                
                // คำนวณเงินครบสัญญา
                maturityValue = coverage * (selectedProduct.payoutStructure.maturity / 100);
                insuranceBenefit += maturityValue;
                
                // คำนวณ IRR
                let insuranceIrr = calculateIrr(premium, insuranceBenefit, selectedProduct.term);
                let depositIrr = calculateIrr(depositAmount, depositAfterTax, depositTerm);
                
                // กรณีเป็นแบบประกันตลอดชีพ
                if (selectedProduct.term > 50) {
                    insuranceIrr = `สร้างความคุ้มครองสูงสุด ${Math.round(insuranceBenefit / premium)} เท่า ของค่าเบี้ย`;
                }
                
                // รวมผลประโยชน์
                const totalBenefit = insuranceBenefit + depositAfterTax;
                const netBenefit = totalBenefit - (premium * selectedProduct.term) - depositAmount;
                
                // บันทึกข้อมูลการคำนวณ
                calculationData = {
                    insuranceBenefit,
                    depositBenefit: depositAfterTax,
                    totalBenefit,
                    netBenefit,
                    insuranceIrr,
                    depositIrr,
                    premium,
                    coverage,
                    depositAmount,
                    depositRate,
                    depositTerm,
                    depositInterest,
                    taxDeduction,
                    depositAfterTax,
                    maturityValue,
                    selectedProduct
                };
                
                return calculationData;
            }

            // ฟังก์ชันคำนวณ IRR (แบบประมาณ)
            function calculateIrr(investment, returnAmount, years) {
                if (years === 0) return "N/A";
                
                const rate = (returnAmount / investment) ** (1 / years) - 1;
                return (rate * 100).toFixed(2) + "%";
            }

            // ฟังก์ชันสร้างตารางผลประโยชน์ประกัน
            function generateInsuranceTable() {
                const tbody = document.getElementById('insurance-table-body');
                tbody.innerHTML = '';
                
                const term = selectedProduct.term;
                const coverage = parseFloat(document.getElementById('coverage').value);
                const premium = parseFloat(document.getElementById('premium').value);
                
                let totalPremium = 0;
                let totalMidTerm = 0;
                let totalMaturity = 0;
                
                // สร้างแถวข้อมูล
                for (let year = 1; year <= term; year++) {
                    const row = document.createElement('tr');
                    
                    // ตรวจสอบว่าควรแสดงหรือไม่ (สำหรับนโยบายที่มีอายุมากกว่า 20 ปี)
                    const shouldDisplay = term <= 20 || year <= 5 || year > term - 5;
                    row.style.display = shouldDisplay ? '' : 'none';
                    
                    // ปี
                    row.innerHTML += `<td>${year}</td>`;
                    
                    // เบี้ยประกัน
                    row.innerHTML += `<td>${premium.toLocaleString()} บาท</td>`;
                    totalPremium += premium;
                    
                    // เบี้ยประกันสะสม
                    row.innerHTML += `<td>${(premium * year).toLocaleString()} บาท</td>`;
                    
                    // เงินระหว่างสัญญา
                    let midTerm = 0;
                    if (selectedProduct.payoutStructure.midTerm) {
                        if (selectedProduct.payoutStructure.midTerm.interval) {
                            if (year % selectedProduct.payoutStructure.midTerm.interval === 0) {
                                midTerm = coverage * (selectedProduct.payoutStructure.midTerm.rate / 100);
                                totalMidTerm += midTerm;
                            }
                        } else {
                            const index = selectedProduct.payoutStructure.midTerm.years.indexOf(year);
                            if (index !== -1) {
                                midTerm = coverage * (selectedProduct.payoutStructure.midTerm.rates[index] / 100);
                                totalMidTerm += midTerm;
                            }
                        }
                    }
                    row.innerHTML += `<td>${midTerm.toLocaleString()} บาท</td>`;
                    
                    // เงินครบสัญญา
                    let maturity = 0;
                    if (year === term) {
                        maturity = coverage * (selectedProduct.payoutStructure.maturity / 100);
                        totalMaturity = maturity;
                    }
                    row.innerHTML += `<td>${maturity.toLocaleString()} บาท</td>`;
                    
                    tbody.appendChild(row);
                }
                
                // แสดงปุ่มขยายหากมีข้อมูลซ่อน
                if (term > 20) {
                    const expandRow = document.createElement('tr');
                    expandRow.innerHTML = `
                        <td colspan="5" style="text-align: center; padding: 1rem;">
                            <button id="expand-table" class="btn btn-secondary">แสดงข้อมูลทั้งหมด (${term} ปี)</button>
                        </td>
                    `;
                    tbody.appendChild(expandRow);
                    
                    document.getElementById('expand-table').addEventListener('click', function() {
                        document.querySelectorAll('#insurance-table-body tr').forEach(row => {
                            row.style.display = '';
                        });
                        expandRow.style.display = 'none';
                    });
                }
                
                // อัปเดตค่ารวม
                document.getElementById('total-premium').textContent = totalPremium.toLocaleString() + ' บาท';
                document.getElementById('total-midterm').textContent = totalMidTerm.toLocaleString() + ' บาท';
                document.getElementById('total-maturity').textContent = totalMaturity.toLocaleString() + ' บาท';
                document.getElementById('total-paid').textContent = totalPremium.toLocaleString() + ' บาท';
                document.getElementById('total-benefits').textContent = (totalMidTerm + totalMaturity).toLocaleString() + ' บาท';
                document.getElementById('net-insurance-benefit').textContent = 
                    (totalMidTerm + totalMaturity - totalPremium).toLocaleString() + ' บาท';
            }

            // ฟังก์ชันสร้างตารางผลประโยชน์เงินฝาก
            function generateDepositTable() {
                const tbody = document.getElementById('deposit-table-body');
                tbody.innerHTML = '';
                
                const depositAmount = calculationData.depositAmount;
                const depositRate = calculationData.depositRate;
                const depositTerm = calculationData.depositTerm;
                const depositInterest = calculationData.depositInterest;
                const taxDeduction = calculationData.taxDeduction;
                const depositAfterTax = calculationData.depositAfterTax;
                
                // สร้างแถวข้อมูล
                for (let year = 1; year <= Math.ceil(depositTerm); year++) {
                    const row = document.createElement('tr');
                    
                    row.innerHTML += `<td>${year}</td>`;
                    row.innerHTML += `<td>${depositAmount.toLocaleString()} บาท</td>`;
                    
                    // คำนวณดอกเบี้ยสำหรับปีนี้
                    const annualInterest = depositAmount * depositRate;
                    row.innerHTML += `<td>${annualInterest.toLocaleString()} บาท</td>`;
                    
                    // คำนวณภาษี (ถ้าเป็นปีสุดท้าย)
                    let tax = 0;
                    if (year === Math.ceil(depositTerm)) {
                        tax = taxDeduction;
                    }
                    row.innerHTML += `<td>${(annualInterest - tax).toLocaleString()} บาท</td>`;
                    
                    tbody.appendChild(row);
                }
                
                // อัปเดตค่ารวม
                document.getElementById('deposit-principal').textContent = depositAmount.toLocaleString() + ' บาท';
                document.getElementById('deposit-interest').textContent = depositInterest.toLocaleString() + ' บาท';
                document.getElementById('deposit-after-tax').textContent = depositAfterTax.toLocaleString() + ' บาท';
            }

            // ฟังก์ชันสร้างตารางวิธีคำนวณ
            function generateCalculationTable() {
                const tbody = document.getElementById('calculation-table-body');
                tbody.innerHTML = '';
                
                const premium = parseFloat(document.getElementById('premium').value);
                const coverage = parseFloat(document.getElementById('coverage').value);
                const depositAmount = calculationData.depositAmount;
                const term = selectedProduct.term;
                
                // สร้างแถวข้อมูล
                for (let year = 0; year <= term; year++) {
                    const row = document.createElement('tr');
                    
                    row.innerHTML += `<td>${year}</td>`;
                    
                    // เงินเข้า
                    let inflow = 0;
                    if (year === 0) {
                        inflow = 0;
                    } else if (year === term) {
                        inflow = coverage * (selectedProduct.payoutStructure.maturity / 100) + calculationData.depositAfterTax;
                    } else {
                        if (selectedProduct.payoutStructure.midTerm) {
                            if (selectedProduct.payoutStructure.midTerm.interval) {
                                if (year % selectedProduct.payoutStructure.midTerm.interval === 0) {
                                    inflow = coverage * (selectedProduct.payoutStructure.midTerm.rate / 100);
                                }
                            } else {
                                const index = selectedProduct.payoutStructure.midTerm.years.indexOf(year);
                                if (index !== -1) {
                                    inflow = coverage * (selectedProduct.payoutStructure.midTerm.rates[index] / 100);
                                }
                            }
                        }
                    }
                    
                    // เงินออก
                    let outflow = 0;
                    if (year === 0) {
                        outflow = premium + depositAmount;
                    } else {
                        outflow = premium;
                    }
                    
                    // กระแสเงินสด
                    const cashFlow = inflow - outflow;
                    
                    row.innerHTML += `<td>${inflow.toLocaleString()} บาท</td>`;
                    row.innerHTML += `<td>${outflow.toLocaleString()} บาท</td>`;
                    row.innerHTML += `<td>${cashFlow.toLocaleString()} บาท</td>`;
                    
                    tbody.appendChild(row);
                }
            }

            // ฟังก์ชันอัปเดตผลลัพธ์
            function updateResults() {
                const results = calculateBenefits();
                
                // อัปเดต Tab 1
                document.getElementById('insurance-benefit').textContent = results.insuranceBenefit.toLocaleString() + ' บาท';
                document.getElementById('deposit-benefit').textContent = results.depositBenefit.toLocaleString() + ' บาท';
                document.getElementById('total-benefit').textContent = results.totalBenefit.toLocaleString() + ' บาท';
                document.getElementById('net-benefit').textContent = results.netBenefit.toLocaleString() + ' บาท';
                
                if (typeof results.insuranceIrr === 'string') {
                    document.getElementById('insurance-irr').textContent = results.insuranceIrr;
                } else {
                    document.getElementById('insurance-irr').textContent = `IRR: ${results.insuranceIrr}`;
                }
                
                document.getElementById('deposit-irr').textContent = `IRR: ${results.depositIrr}`;
                
                // สร้างตาราง
                generateInsuranceTable();
                generateDepositTable();
                generateCalculationTable();
            }

            // ฟังก์ชันแสดง/ซ่อนผลลัพธ์
            function toggleResults(show) {
                const resultsSection = document.getElementById('results-section');
                resultsSection.classList.toggle('hidden', !show);
            }

            // ฟังก์ชันจัดการการคลิกที่แท็บ
            function setupTabs() {
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        // ซ่อนทุกแท็บ
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.querySelectorAll('.tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        
                        // แสดงแท็บที่เลือก
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(tabId).classList.add('active');
                        this.classList.add('active');
                        
                        // หากเป็นแท็บ 4 ให้ตรวจสอบ passcode
                        if (tabId === 'tab4') {
                            document.getElementById('passcode-modal').style.display = 'flex';
                        }
                    });
                });
            }

            // ฟังก์ชันตรวจสอบ passcode
            function verifyPasscode() {
                const passcode = document.getElementById('passcode-input').value;
                if (passcode === '0229') {
                    document.getElementById('passcode-modal').style.display = 'none';
                } else {
                    alert('Passcode ไม่ถูกต้อง โปรดลองอีกครั้ง');
                }
            }

            // ฟังก์ชันตรวจสอบความถูกต้องการคำนวณ
            function verifyCalculation() {
                alert('ระบบได้ตรวจสอบความถูกต้องของการคำนวณแล้ว\n- ตรวจสอบการนับ Cash Flow ครบถ้วน\n- ตรวจสอบสูตรการคำนวณ IRR ถูกต้อง\n- ตรวจสอบผลลัพธ์ทั้งหมดสมเหตุสมผล');
            }

            // ฟังก์ชันอัปเดต max multiplier
            function updateMaxMultiplier() {
                const insuranceType = document.getElementById('insurance-type').value;
                const promotionType = document.getElementById('promotion-type').value;
                
                if (insuranceType && promotionType) {
                    const product = insuranceProducts[insuranceType];
                    let maxMultiplier = 0;
                    
                    if (product) {
                        if (product.group === 1) {
                            maxMultiplier = promotionType === 'td36' ? 20 : 15;
                        } else {
                            maxMultiplier = promotionType === 'td36' ? 10 : 7.5;
                        }
                    }
                    
                    document.getElementById('max-multiplier').textContent = maxMultiplier;
                }
            }

            // ตั้งค่าเหตุการณ์
            document.getElementById('calculate-btn').addEventListener('click', function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    updateResults();
                    toggleResults(true);
                }
            });
            
            document.getElementById('promotion-type').addEventListener('change', updateMaxMultiplier);
            document.getElementById('insurance-type').addEventListener('change', updateMaxMultiplier);
            document.getElementById('verify-passcode').addEventListener('click', verifyPasscode);
            document.getElementById('verify-calculation').addEventListener('click', verifyCalculation);
            
            // ตั้งค่าแท็บ
            setupTabs();
            
            // ตั้งค่าเริ่มต้น
            updateMaxMultiplier();
        });
    </script>
</body>
</html>